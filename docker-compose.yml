version: "3.8"

services:
    # NANDA Points MCP Server
    nanda-points-server:
        build: .
        container_name: nanda-points-server
        restart: unless-stopped
        ports:
            - "3000:3000" # MCP Server
            - "8080:8080" # API Server
        environment:
            NODE_ENV: production
            MCP_PORT: 3000
            API_PORT: 8080
            HOST: 0.0.0.0
            # Connect to NANDA's actual database
            MONGODB_URI: ${MONGODB_URI}
            NP_DB_NAME: ${NP_DB_NAME:-nanda_points}
        healthcheck:
            test:
                [
                    "CMD",
                    "node",
                    "-e",
                    "require('http').get('http://localhost:3000/health', (res) => { process.exit(res.statusCode === 200 ? 0 : 1) })",
                ]
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 40s
